<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="https://linh-ng.dev/images/logo.png">
<meta name="generator" content="Hugo 0.57.2" />


    <title>Understanding Priority on Linux Processes - Linh Nguyen&#39;s Blog</title>
    <meta property="og:title" content="Understanding Priority on Linux Processes - Linh Nguyen&#39;s Blog">
    <meta property="og:site_name" content="Linh Nguyen&#39;s Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:description" content="" />
    
    <meta property="og:url" content="https://linh-ng.dev/post/understanding-priority-on-linux-processes.html" />
    <meta property="article:published_time" content="2018-11-13T00:23:57Z" />
    

    <meta property="article:publisher" content="#" />
    <meta property="article:author" content="#" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Understanding Priority on Linux Processes - Linh Nguyen&#39;s Blog" />
    <meta name="twitter:description" content="" />
    <meta name="twitter:url" content="https://linh-ng.dev/post/understanding-priority-on-linux-processes.html" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Linh Nguyen" />
    <meta name="twitter:site" content="https://twitter.com/#" />
    <meta name="twitter:creator" content="#" />



  







<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZYB28TCKZV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZYB28TCKZV');
</script>

<link rel="stylesheet" href="https://linh-ng.dev/css/main.css?v=1.0.2" media="all">
<link rel="stylesheet" href="https://linh-ng.dev/css/font-awesome.min.css" media="all">
<link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://linh-ng.dev/" class="nav-logo">
    <img src="https://linh-ng.dev/images/logo.png" 
         width="50" 
         height="50" 
         alt="linh-ng.dev - N√≥i √≠t th√¥i v√† ƒë∆∞a code ƒë√¢y">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about-me.html">About me</a></li>
    
    <li><a href="/tag/database">Database</a></li>
    
    <li><a href="/tag/devops">DevOps</a></li>
    
    <li><a href="/tag/linux">Linux</a></li>
    
    <li><a href="https://linh-ng.dev/LinhNguyen_DevOps_Resume.pdf">Resume</a></li>
    
    <li><a href="/tag/til">TIL</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

<article class="article">
    
    <span class="article-duration"><i class="fa fa-clock-o"></i> 6 min read</span>
    

    <h1 class="article-title">Understanding Priority on Linux Processes</h1>

    
    <span class="article-date"><i class="fa fa-calendar"></i> November 13, 2018</span>
    

    <div class="article-content">
        

<p>M·ªôt bu·ªïi s√°ng nh∆∞ bao ng√†y b√¨nh th∆∞·ªùng, m√¨nh th·ª©c d·∫≠y v√† t·ª± h·ªèi: H√¥m nay m√¨nh ph·∫£i l√†m nh·ªØng vi·ªác g√¨ nh·ªâ? ƒê·ªëi v·ªõi m·ªôt ng∆∞·ªùi d√π kh√¥ng bi·∫øt s·∫Øp x·∫øp k·∫ø ho·∫°ch nh∆∞ m√¨nh th√¨ nh·ªØng vi·ªác c∆° b·∫£n sau s·∫Ω ƒë∆∞·ª£c th·ª±c hi·ªán:</p>

<ul>
<li>V·ªá sinh c√° nh√¢n. ƒê√°nh rƒÉng, r·ª≠a m·∫∑t, t·∫Øm r·ª≠a</li>
<li>ƒÇn s√°ng v√† ƒëi l√†m</li>
<li>Gi·∫£i quy·∫øt t·ª´ng task ƒëang t·ªìn ƒë·ªçng</li>
<li>Nghe s·∫øp ch·ª≠i. Ch√°n ƒë√≠u mu·ªën l√†m n·ªØa v√† ngh·ªâ vi·ªác.</li>
<li>ƒêang b·ª±c ng∆∞·ªùi y√™u l√©o nh√©o v√† chia tay</li>
<li>V·ªÅ nh√† ng·ªìi vi·∫øt nh·ªØng d√≤ng n√†y‚Ä¶.</li>
</ul>

<p>ƒê√πa ch√∫t th√¥i, m√¨nh ƒë√£ qua c√°i tu·ªïi chia tay ng∆∞·ªùi y√™u r·ªìi üò´</p>

<p>M√¨nh ch·ªâ ƒë·ªãnh n√≥i m·ªôt ƒëi·ªÅu ƒë√≥ l√†: V·ªõi m·ªôt ng∆∞·ªùi b√¨nh th∆∞·ªùng, h√†ng ng√†y b·∫°n ph·∫£i handle h√†ng t√° c√°c c√¥ng vi·ªác kh√°c nhau c√πng m·ªôt l√∫c. B·∫°n ƒë√£ ch·ªçn l√†m vi·ªác n√†y hay vi·ªác kia tr∆∞·ªõc nh∆∞ n√†o? R·∫•t may m·∫Øn l√† nh·ªù n√£o b·∫°n bi·∫øt vi·ªác A ph·∫£i ƒë∆∞·ª£c ∆∞u ti√™n h∆°n vi·ªác B. Ho·∫∑c s·∫øp b·∫£o b·∫°n c·ª© l√†m ƒëi m·∫∑c d√π b·∫°n th·∫•y n√≥ ch·∫≥ng quan tr·ªçng m√©o g√¨ c·∫£ üí©</p>

<h2 id="1-priority-l√†-c√°i-g√¨">1. Priority l√† c√°i g√¨?</h2>

<p>L√† c√°ch c√°c b·∫°n ∆∞u ti√™n vi·ªác A hay vi·ªác B h∆°n ƒë√≥. V·ªõi con ng∆∞·ªùi l√† v·∫≠y c√≤n Linux th√¨ sao? N√≥ c≈©ng same v·∫≠y th√¥i.</p>

<p>B·∫°n s·∫Ω n√≥i v·ªõi n√≥ r·∫±ng:</p>

<blockquote>
<p>M√†y ph·∫£i ∆∞u ti√™n ch·∫°y process A c·ªßa tao nh√©, c√≤n process B c·ªßa th·∫±ng C th√¨ t√∫c t·∫Øc c≈©ng ƒë∆∞·ª£c.</p>
</blockquote>

<p>C√°i guidelines ƒë√≥ ƒë∆∞·ª£c g·ªçi l√† <code>niceness</code> ho·∫∑c <code>nice value</code> trong Linux. V·ªõi nh·ªØng b·∫°n ch∆∞a bi·∫øt th√¨ <code>nice</code> l√† m·ªôt program c√≥ tr√™n Unix ho·∫∑c h·ªç Unix nh∆∞ Linux. N√≥ cho ph√©p th·ª±c thi m·ªôt command ho·∫∑c m·ªôt shell script v·ªõi ƒë·ªô ∆∞u ti√™n x√°c ƒë·ªãnh. ƒêi·ªÅu ƒë√≥ c√≥ nghƒ©a r·∫±ng CPU s·∫Ω hi·ªÉu process n√†y ƒë∆∞·ª£c ∆∞u ti√™n nhi·ªÅu resources h∆°n process kh√°c.</p>

<p>V·ªõi kho·∫£ng gi√° tr·ªã c·ªßa <code>nice value</code> t·ª´ -20 ƒë·∫øn 19. Gi√° tr·ªã c√†ng th·∫•p, ƒë·ªô ∆∞u ti√™n c√†ng cao. N·∫øu m·ªôt process c√≥ <code>nice value</code> l·ªõn h∆°n 19, CPU s·∫Ω th·ª±c thi n√≥ l√∫c n√†o <strong>c√≥ th·ªÉ</strong> hay n√≥i m·ªôt c√°ch vƒÉn h·ªçc l√† <code>L√∫c n√†o r·∫£nh tao s·∫Ω ch·∫°y process c·ªßa m√†y, OK?</code></p>

<blockquote>
<p>L∆∞u √Ω: Gi√° tr·ªã m·∫∑c ƒë·ªãnh c·ªßa <code>niceness</code> hay <code>nice value</code> l√† 0</p>
</blockquote>

<p>V·ªõi <code>nice value</code>, ch√∫ng ta d·ªÖ d√†ng ki·ªÉm so√°t CPU s·ª≠ d·ª•ng t√†i nguy√™n m·ªôt c√°ch hi·ªáu qu·∫£ nh·∫•t. Nh·ªØng process n√†o quan tr·ªçng, b·∫°n c√≥ th·ªÉ set <code>nice value</code> th·∫•p ƒë·ªÉ CPU hi·ªÉu r·∫±ng n√≥ c·∫ßn quan t√¢m c·∫©n th·∫≠n nh·ªØng ch√°u n√†y v√† ng∆∞·ª£c l·∫°i.</p>

<p>Ngo√†i ra, n·∫øu b·∫°n c√≥ quan h·ªá th√¢n thi·∫øt v·ªõi anh DevOps, b·∫°n c√≥ th·ªÉ nh·ªù anh √Ω set <code>nice value</code> cho user b·∫°n th·∫•p h∆°n default ƒë·ªÉ c√°c processes  ƒë∆∞·ª£c ng·ªën resources nhi·ªÅu h∆°n. ƒêi·ªÅu n√†y ho√†n to√†n h·ª£p l·ªá v√† ƒë∆∞·ª£c c√¥ng nh·∫≠n trong hi·∫øn ph√°p lu√¥n ƒë√≥ üòé</p>

<h2 id="2-t√¥i-ki·ªÉm-tra-process-c·ªßa-t√¥i-ƒë∆∞·ª£c-∆∞u-ti√™n-nh∆∞-n√†o">2. T√¥i ki·ªÉm tra process c·ªßa t√¥i ƒë∆∞·ª£c ∆∞u ti√™n nh∆∞ n√†o?</h2>

<p>C√°ch ƒë∆°n gi·∫£n nh·∫•t l√† s·ª≠ d·ª•ng l·ªánh <code>top</code></p>

<p><img src="https://i.imgur.com/iEsk2oK.png" alt="Use top command" /></p>

<p>M·ªôt c√°ch kh√°c l√† s·ª≠ d·ª•ng l·ªánh <code>ps</code>. Trong ƒë√≥ <code>NI</code> ch√≠nh l√† <code>nice value</code></p>

<p><code>ps -o pid,comm,nice -p 246</code></p>

<p>K·∫øt qu·∫£ s·∫Ω nh∆∞ h√¨nh:</p>

<p><img src="https://i.imgur.com/ttxMnqo.png" alt="Use ps command" /></p>

<h2 id="3-t√¥i-mu·ªën-lower-nice-value-khi-ch·∫°y-process-m·ªõi-th√¨-l√†m-sao">3. T√¥i mu·ªën lower <code>nice value</code> khi ch·∫°y process m·ªõi th√¨ l√†m sao?</h2>

<p>ƒê·ªÉ CPU ∆∞u √°i process c·ªßa b·∫°n h∆°n, g√µ ngay l·ªánh sau v√†o terminal</p>

<p><code>nice -n -20 wget https://p**nhub.com/download/xxxxxxxxxxx.mp4</code></p>

<blockquote>
<p>L∆∞u √Ω: Kh√¥ng n√™n th·ª≠ tr√™n production. Ch·ªâ nh·ªØng chuy√™n gia c√≥ kinh nghi·ªám (b·ªã ƒëu·ªïi vi·ªác) nh∆∞ m√¨nh m·ªõi n√™n l√†m ƒëi·ªÅu ƒë√≥.</p>
</blockquote>

<p>M·ªôt ƒëi·ªÅu ghi nh·ªõ ƒë√≥ l√†: Gi√° tr·ªã c·ªßa <code>nice value</code> l√† s·ªë d∆∞∆°ng s·∫Ω l√†m ƒë·ªô ∆∞u ti√™n c·ªßa process gi·∫£m ƒëi so v·ªõi m·∫∑c ƒë·ªãnh ƒë·∫•y.</p>

<h2 id="4-process-ƒëang-ch·∫°y-nh∆∞ng-t√¥i-mu·ªën-nice-value-c·ªßa-n√≥-th·∫•p-h∆°n-n·ªØa-th√¨-sao">4. Process ƒëang ch·∫°y nh∆∞ng t√¥i mu·ªën <code>nice value</code> c·ªßa n√≥ th·∫•p h∆°n n·ªØa th√¨ sao?</h2>

<p>R√µ r√†ng c√≥ nh·ªØng l√∫c th·∫•y process c√≥ v·∫ª ch·∫≠m ch·∫°p, thay v√¨ ph·∫£i ch·ªù ƒë·∫øn l√∫c CPU r·∫£nh rang h∆°n ch√∫t, b·∫°n c√≥ th·ªÉ nh·ªù anh CPU quan t√¢m m√¨nh h∆°n b·∫±ng m·ªôt c√°i phong b√¨ v·ªõi c√∫ ph√°p sau:</p>

<p><code>renice [nice value] -p [process ID]</code></p>

<p>V√≠ d·ª•:</p>

<p><code>renice -5 -p 4051</code></p>

<p><img src="https://i.imgur.com/eqpE5Ly.png" alt="C√≥ quan h·ªá t·ªët v·ªõi anh DevOps ƒë√≥" /></p>

<p>ƒêi·ªÅu n√†y l√†m process c·ªßa b·∫°n ƒë∆∞·ª£c ∆∞u ti√™n h∆°n nh·ªØng th·∫±ng default value b·∫±ng 0 kh√°c üòã</p>

<blockquote>
<p>L∆∞u √Ω quan tr·ªçng: Ch·ªâ c√≥ root ho·∫∑c sudoers m·ªõi c√≥ quy·ªÅn set gi√° tr·ªã <code>nice value</code> l√† s·ªë √¢m. B·∫°n ƒë√£ hi·ªÉu v√¨ sao ph·∫£i l√†m th√¢n anh DevOps r·ªìi ch·ª© :omg:</p>
</blockquote>

<h2 id="5-t√¥i-ƒë√£-l√†m-th√¢n-anh-devops-r·ªìi-l√†m-sao-ƒë·ªÉ-process-c·ªßa-t√¥i-ƒë∆∞·ª£c-∆∞u-ti√™n">5. T√¥i ƒë√£ l√†m th√¢n anh DevOps r·ªìi, l√†m sao ƒë·ªÉ process c·ªßa t√¥i ƒë∆∞·ª£c ∆∞u ti√™n?</h2>

<p>N·∫øu ƒë√£ l√†m th√¢n v·ªõi anh DevOps, m·ªçi chuy·ªán d·∫ßn d·ªÖ d√†ng h∆°n r·ªìi ƒë·∫•y. B·∫°n nh·ªù anh ta s·ª≠a file <code>/etc/security/limits.conf</code> l√† ƒë∆∞·ª£c. Syntax nh∆∞ sau:</p>

<p><code>[username] [hard|soft] priority [nice value]</code></p>

<p>V√≠ d·ª•:</p>

<p><code>tanlinhnd hard priority -10</code></p>

<p>Th·ª±c ra file <code>/etc/security/limits.conf</code> kh√¥ng ch·ªâ ƒë∆°n thu·∫ßn limit priority c·ªßa t·ª´ng user, m√¨nh paste lu√¥n ph·∫ßn <code>man</code> ƒë·ªÉ c√°c b·∫°n tham kh·∫£o.</p>

<pre><code># /etc/security/limits.conf
#
#Each line describes a limit for a user in the form:
#
#&lt;domain&gt;        &lt;type&gt;  &lt;item&gt;  &lt;value&gt;
#
#Where:
#&lt;domain&gt; can be:
#        - a user name
#        - a group name, with @group syntax
#        - the wildcard *, for default entry
#        - the wildcard %, can be also used with %group syntax,
#                 for maxlogin limit
#        - NOTE: group and wildcard limits are not applied to root.
#          To apply a limit to the root user, &lt;domain&gt; must be
#          the literal username root.
#
#&lt;type&gt; can have the two values:
#        - &quot;soft&quot; for enforcing the soft limits
#        - &quot;hard&quot; for enforcing hard limits
#
#&lt;item&gt; can be one of the following:
#        - core - limits the core file size (KB)
#        - data - max data size (KB)
#        - fsize - maximum filesize (KB)
#        - memlock - max locked-in-memory address space (KB)
#        - nofile - max number of open files
#        - rss - max resident set size (KB)
#        - stack - max stack size (KB)
#        - cpu - max CPU time (MIN)
#        - nproc - max number of processes
#        - as - address space limit (KB)
#        - maxlogins - max number of logins for this user
#        - maxsyslogins - max number of logins on the system
#        - priority - the priority to run user process with
#        - locks - max number of file locks the user can hold
#        - sigpending - max number of pending signals
#        - msgqueue - max memory used by POSIX message queues (bytes)
#        - nice - max nice priority allowed to raise to values: [-20, 19]
#        - rtprio - max realtime priority
#        - chroot - change root to directory (Debian-specific)
#
#&lt;domain&gt;      &lt;type&gt;  &lt;item&gt;         &lt;value&gt;
#

#*               soft    core            0
#root            hard    core            100000
#*               hard    rss             10000
#@student        hard    nproc           20
#@faculty        soft    nproc           20
#@faculty        hard    nproc           50
#ftp             hard    nproc           0
#ftp             -       chroot          /ftp
#@student        -       maxlogins       4

# End of file
</code></pre>

<p>Cu·ªëi c√πng, b√†i vi·∫øt ch·ª©a r·∫•t nhi·ªÅu v√≠ d·ª• ƒë∆∞·ª£c th·ª±c hi·ªán b·ªüi chuy√™n gia. Vui l√≤ng kh√¥ng th·ª≠ tr√™n production ƒë·ªÉ tr√°nh b·ªã ƒëu·ªïi vi·ªác üòú.</p>

<p>Cheers,</p>

<h2 id="6-references">6. References</h2>

<p>[1] Wikipedia <a href="https://en.wikipedia.org/wiki/Nice_(Unix)">nice (Unix)</a></p>

<p>[2] nixtutor.com <a href="https://www.nixtutor.com/linux/changing-priority-on-linux-processes/">Changing Priority on Linux Processes</a></p>

    </div>
    
    <h2>Tags:</h2>
        
        <a href="/tag/niceness" class="tags"><i class="fa fa-hashtag"></i> niceness</a>
        
        <a href="/tag/nice-value" class="tags"><i class="fa fa-hashtag"></i> nice value</a>
        
        <a href="/tag/devops" class="tags"><i class="fa fa-hashtag"></i> devops</a>
        
        <a href="/tag/linux" class="tags"><i class="fa fa-hashtag"></i> linux</a>
        
    

    
</article>


</main>
<footer class="footer">
    <ul class="footer-links">
        <li>
            <a href="https://linh-ng.dev/">¬© 2017 linh-ng.dev</a>
        </li>
        <li>
            <a href="https://linh-ng.dev/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
        </li>
        <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <i class="fa fa-heart" style="color:#D14;"></i> using <img src="https://linh-ng.dev/images/hugo-logo.png" width="22" height="22"></a>
        </li>
    </ul>
    <ul class="footer-social">
        <li><a href="https://github.com/ps-ef" target="_blank"><i class="fa fa-github fa-2x"></i></a></li>
        <li><a href="#" target="_blank"><i class="fa fa-linkedin fa-2x"></i></a></li>
        <li><a href="#" target="_blank"><i class="fa fa-instagram fa-2x"></i></a></li>
    </ul>
    <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>
</footer>

</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'G-ZYB28TCKZV', 'auto');
	
	ga('send', 'pageview');
}
</script>

</body>

</html>

